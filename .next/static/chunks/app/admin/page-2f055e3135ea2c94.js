(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{4291:function(e,t,r){Promise.resolve().then(r.bind(r,6683))},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},6683:function(e,t,r){"use strict";r.r(t);var a=r(7437),s=r(9376),l=r(2265),n=r(9953);t.default=()=>{let[e,t]=(0,l.useState)([]),[r,d]=(0,l.useState)(!0),[i,c]=(0,l.useState)(1),[o,u]=(0,l.useState)(1),[p,h]=(0,l.useState)({resolved:!1}),x=(0,s.useRouter)(),[b,m]=(0,l.useState)(0),y=async e=>{d(!0);try{var r,a,s,l,n,i;let d=document.location.search.slice(1).split("&")[0].split("=")[1];if(!d){x.push("/");return}let o=await fetch("/api/v1/admin?token=".concat(d,"&page=").concat(e,"&perPage=30&id=").concat(null!==(r=p.id)&&void 0!==r?r:"","&name=").concat(null!==(a=p.name)&&void 0!==a?a:"","&email=").concat(null!==(s=p.email)&&void 0!==s?s:"","&query=").concat(null!==(l=p.query)&&void 0!==l?l:"","&resolved=").concat(null!==(n=p.resolved)&&void 0!==n?n:""));if(403===o.status){x.push("/");return}if(200===o.status){let e=null===(i=await o.json())||void 0===i?void 0:i.data;t(e.queries),u(e.pagination.totalPages),m(e.pagination.totalRecords),c(e.pagination.currentPage)}}catch(e){console.error("Error fetching queries:",e),alert("Failed to fetch queries.")}finally{d(!1)}};(0,l.useEffect)(()=>{y(i)},[i,p]);let g=async(r,a)=>{if(confirm("Changing status to [ ".concat(a?"RESOLVED":"NOT resolved"," ]\n\nAre you sure?")))try{let l=document.location.search.slice(1).split("&")[0].split("=")[1];if(!l){x.push("/");return}let n=await fetch("/api/v1/admin?token=".concat(l),{method:"PUT",body:JSON.stringify({id:r,resolved:a})});if(403===n.status){x.push("/");return}if(200===n.status){let l=await n.json();if(l.ok)t(e.map(e=>e.id===r?{...e,resolved:a}:e));else{var s;alert(null!==(s=l.message)&&void 0!==s?s:"Error updating query status.")}}}catch(e){console.error("Error updating query:",e),alert("An error occurred while updating the query.")}},v=(e,t)=>{h(r=>({...r,[t]:"checkbox"===e.target.type?e.target.checked:e.target.value}))};return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-end gap-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"Filter by ID",value:p.id,onChange:e=>v(e,"id"),className:"rounded border px-4 py-2"}),(0,a.jsx)("input",{type:"text",placeholder:"Filter by Name",value:p.name,onChange:e=>v(e,"name"),className:"rounded border px-4 py-2"}),(0,a.jsx)("input",{type:"text",placeholder:"Filter by Email",value:p.email,onChange:e=>v(e,"email"),className:"rounded border px-4 py-2"}),(0,a.jsx)("input",{type:"text",placeholder:"Filter by Query",value:p.query,onChange:e=>v(e,"query"),className:"rounded border px-4 py-2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"resolvedFilter",children:"Resolved "}),(0,a.jsx)("input",{id:"resolvedFilter",type:"checkbox",checked:!!p.resolved,onChange:e=>v(e,"resolved"),className:"rounded border px-4 py-2"})]}),"|\xa0\xa0\xa0Count: ",b]}),(0,a.jsx)("div",{children:r?(0,a.jsx)("p",{className:"text-center text-lg",children:"Loading..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("table",{className:"min-w-full table-auto border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border-b px-4 py-2",children:"ID"}),(0,a.jsx)("th",{className:"border-b px-4 py-2",children:"Name"}),(0,a.jsx)("th",{className:"border-b px-4 py-2",children:"Email"}),(0,a.jsx)("th",{className:"border-b px-4 py-2",children:"Query"}),(0,a.jsx)("th",{className:"border-b px-4 py-2",children:"Created"}),(0,a.jsx)("th",{className:"border-b px-4 py-2",children:"Updated"}),(0,a.jsx)("th",{className:"border-b px-4 py-2",children:"Status"}),(0,a.jsx)("th",{className:"border-b px-4 py-2",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border-b px-4 py-2",children:e.id}),(0,a.jsx)("td",{className:"border-b px-4 py-2",children:e.name}),(0,a.jsx)("td",{className:"border-b px-4 py-2",children:(0,a.jsx)("a",{className:"hover:text-blue-700 hover:underline",href:"mailto:".concat(e.email),children:e.email})}),(0,a.jsx)("td",{className:"border-b px-4 py-2",children:e.query}),(0,a.jsx)("td",{className:"border-b px-4 py-2",children:(0,n.p)(e.createdAt)}),(0,a.jsx)("td",{className:"border-b px-4 py-2",children:(0,n.p)(e.updatedAt)}),(0,a.jsx)("td",{className:"border-b px-4 py-2",children:e.resolved?"RESOLVED":"NOT resolved"}),(0,a.jsx)("td",{className:"border-b px-4 py-2",children:(0,a.jsx)("button",{onClick:()=>g(e.id,!e.resolved),className:"mr-2 rounded bg-blue-500 px-4 py-2 text-white hover:bg-blue-700",children:"Toggle Status"})})]},e.id))})]}),o>1&&(0,a.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-4",children:[(0,a.jsx)("button",{onClick:()=>{i>1&&c(i-1)},disabled:1===i,className:"rounded-lg bg-blue-500 px-4 py-2 text-white disabled:bg-gray-400",children:"Previous"}),(0,a.jsxs)("span",{className:"text-lg",children:["Page ",i," of ",o]}),(0,a.jsx)("button",{onClick:()=>{i<o&&c(i+1)},disabled:i===o,className:"rounded-lg bg-blue-500 px-4 py-2 text-white disabled:bg-gray-400",children:"Next"})]})]})})]})}},9953:function(e,t,r){"use strict";r.d(t,{p:function(){return a}});let a=e=>new Date(new Date(e).getTime()+198e5).toLocaleString("en-GB",{weekday:void 0,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:void 0}).replace(",","").replace("/","-").replace("/","-")}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4291)}),_N_E=e.O()}]);